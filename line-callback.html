<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>LINE ç¶å®šå®Œæˆ</title>
</head>
<body>
  <h2>ç¶å®šæˆåŠŸï¼Œè¬è¬ï¼</h2>
  <p>è«‹ç¨å¾Œï¼Œæˆ‘å€‘æ­£åœ¨è™•ç†æ‚¨çš„è³‡æ–™...</p>
  <script>
    async function main() {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');

      const res = await fetch("https://api.line.me/oauth2/v2.1/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          grant_type: "authorization_code",
          code: code,
          redirect_uri: "https://www.xdliang.net/line-callback.html",
          client_id: "2007624156",
          client_secret: "f0d8dc36fbe68d65546393db4e76e518"
        })
      });
      const tokenData = await res.json();

      const profileRes = await fetch("https://api.line.me/v2/profile", {
        headers: { Authorization: `Bearer ${tokenData.access_token}` }
      });
      const profile = await profileRes.json();

      // å¯«å…¥ Google Sheets
      await fetch("https://script.google.com/macros/s/AKfycbzq-70Lxe2_owvdEiAV05Z1snrIXmYYLBXR42J29yy3zg_QpIKO1QRu0QXEaBJUdrsn/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: profile.displayName,
          userId: profile.userId
        })
      });

      document.body.innerHTML += `<p>ç¶å®šå®Œæˆï¼Œ${profile.displayName}ï¼</p>`;
    }

    main();

    console.log(profile);

  </script>

  <script>
  async function main() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    const res = await fetch("https://api.line.me/oauth2/v2.1/token", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({
        grant_type: "authorization_code",
        code: code,
        redirect_uri: "https://www.xdliang.net/line-callback.html",
        client_id: "ä½ çš„ChannelID",
        client_secret: "ä½ çš„ChannelSecret"
      })
    });

    const tokenData = await res.json();

    const profileRes = await fetch("https://api.line.me/v2/profile", {
      headers: { Authorization: `Bearer ${tokenData.access_token}` }
    });
    const profile = await profileRes.json();

    // ğŸ”§ å¯«å…¥ Google Sheets
    fetch("https://script.google.com/macros/s/ä½ çš„WebAppéƒ¨ç½²ç¶²å€/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: profile.displayName,
        userId: profile.userId
      })
    })
    .then(res => res.text())
    .then(result => {
      console.log("å¯«å…¥å›æ‡‰ï¼š", result);
      document.body.innerHTML += `<p>ä¼ºæœå™¨å›æ‡‰ï¼š${result}</p>`;
    })
    .catch(err => {
      console.error("å¯«å…¥éŒ¯èª¤ï¼š", err);
      document.body.innerHTML += `<p>éŒ¯èª¤ï¼š${err}</p>`;
    });
  }

  main(); // ğŸš€ åŸ·è¡Œ async function
</script>

  
</body>
</html>
